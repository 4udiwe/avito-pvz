# PVZ Backend Service
Сервис для сотрудников ПВЗ (пункта выдачи заказов), позволяющий регистрировать ПВЗ, проводить приёмки и добавлять товары в рамках приёмок.

## Настройка и запуск
1. Клонируйте репозиторий
```
git clone https://github.com/4udiwe/avito-pvz
cd avito-pvz
```
2. Создайте файл `.env` в корне проекта (можно скопировать [`.env.example`](.env.example)).
3. Выполните команду
```
docker compose up --build -d
```
4. Для остановки используйте команду
```
docker compose down --remove-orphans
```

Сервер доступен по адресу __localhost:8080__

## Функциональные требования
Сервис предоставляет API для работы с пунктами выдачи заказов.
Реализованы ендпоинты для создания пунктов выдачи и управления приемками и товарами.

Спецификация API: [ссылка](https://github.com/avito-tech/tech-internship/blob/main/Tech%20Internships/Backend/Backend-trainee-assignment-spring-2025/swagger.yaml).

## Ролевая модель
Реализована авторизация с JWT-токенами и ролями:
- Создание ПВЗ - только moderator
- Просмотр данных о всех ПВЗ - moderator/employee
- Управление приемками и товарами - employee

## Нефункциональные требования
### Тестирование
Покрытие бизнес-логики тестами составляет __97.5%__
Для информации о покрытии можно воспользоваться командой `make cover`.

Выполнен интеграционный тест, в рамках которого происходит регистрация модератора (moderator) и сотрудника (employee), затем создается один ПВЗ, открывается приемка и добавляется 50 товаров различных категорий.

* Для запуска модульных тестов используйте команду `go test -v ./internal/...`
* Для запуска интеграционных тестов используйте команду `make integration-test`

### Метрики
В проекте добавлен сбор метрик с помощью __Prometheus__. Метрики отдаются по адресу __localhost:9000/metrics__. Сам prometheus доступен на порту __localhost:9090__.

Также добавлена __Grafana__ для отображения информации метрик. По адресу __localhost:3000__ в разделе dashboards можно найти два дашборда:
- с бизнес-метриками (кол-во созданных пунктов, приемок, товаров и ошибки)
- с техническими метриками (кол-во запросов, время задержки)

### Дополнительно
Настроено подробное логирование - __logrus__.
Настроена кодогенерация DTO, которые используются в ендпоинтах - __oapi-codegen__.

Кодогеренацию (как DTO так и моков для тестов) можно запустить с помощью команды `go generate ./...`

Настроены линтеры, запускаются командой __golangci-lint run ./...__

## Стек
- Go
- PostgreSQL
- Docker & Docker Compose
- Prometheus
- Grafana